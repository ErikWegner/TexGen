<?php

function texgen_menu() {
    $item = array();

    $items['texgen'] = array(
        'title' => 'LaTeX Generator',
        'page callback' => 'texgen_page',
        'access arguments' => array('access content'),
        'type' => MENU_NORMAL_ITEM,
    );

    $items['texgen/doc'] = array(
        'title' => t('Document generator'),
        'page callback' => 'drupal_get_form',
        'page arguments' => array('texgen_docgenform'),
        'access arguments' => array('access content'),
        'type' => MENU_CALLBACK,
    );

    $items['texgen/letter'] = array(
        'title' => t('Letter generator'),
        'page callback' => 'drupal_get_form',
        'page arguments' => array('texgen_lettergenform'),
        'access arguments' => array('access content'),
        'type' => MENU_CALLBACK,
    );

    return $items;
}

function texgen_lettergenform($formstate) {
    $form['sender'] = array(
        '#type' => 'fieldset',
        '#title' => t('Sender'),
    );

    $form['sender']['fromname'] = array(
        '#type' => 'textfield',
        '#title' => t('Name'),
    );

    $form['sender']['fromaddress'] = array(
        '#type' => 'textarea',
        '#title' => t('Address'),
        '#default_value' => "Straße~Hausnummer\nPLZ~Ort",
    );

    $form['sender']['fromemail'] = array(
        '#type' => 'textfield',
        '#title' => t('Email'),
    );
    $form['sender']['swfromemail'] = array(
        '#type' => 'checkbox',
        '#title' => t('Show email address in letterhead'),
    );

    $form['sender']['fromurl'] = array(
        '#type' => 'textfield',
        '#title' => t('Homepage'),
    );
    $form['sender']['swfromurl'] = array(
        '#type' => 'checkbox',
        '#title' => t('Show homepage in letterhead'),
    );

    $form['sender']['fromphone'] = array(
        '#type' => 'textfield',
        '#title' => t('Telephone'),
        '#description' => t('Group figures by using \, as delimiter')
    );
    $form['sender']['swfromphone'] = array(
        '#type' => 'checkbox',
        '#title' => t('Show telephone number in letterhead'),
    );

    $form['sender']['fromfax'] = array(
        '#type' => 'textfield',
        '#title' => t('Fax'),
        '#description' => t('Group figures by using \, as delimiter')
    );
    $form['sender']['swfromfax'] = array(
        '#type' => 'checkbox',
        '#title' => t('Show fax number in letterhead'),
    );

    $form['sender']['fromlogo'] = array(
        '#type' => 'textfield',
        '#title' => t('Logo'),
        '#description' => t('Command to display a logo')
    );

//    $form['sender']['frombank'] = array(
//        '#type' => 'textfield',
//        '#title' => t('Account'),
//        '#description' => t('Information about your banking account, this value is not processed at the moment.')
//    );

    $form['sender']['location'] = array(
        '#type' => 'textarea',
        '#title' => t('Additional information'),
        '#description' => t('E.g. additional business information')
    );

    $form['sender']['swfromrule'] = array(
        '#type' => 'select',
        '#title' => t('Rule'),
        '#options' => array(
            'afteraddress' => t('Underneath sender information block'),
            'aftername' => t('Right after sender name'),
            'swfromruleoff' => t('No rule'),
        ),
        '#default_value' => 'swfromruleoff'
    );



    $form['letter'] = array(
        '#type' => 'fieldset',
        '#title' => t('Subject, title, recipient'),
    );

    $form['letter']['subject'] = array(
        '#type' => 'textfield',
        '#title' => t('Subject'),
    );

    $form['letter']['title'] = array(
        '#type' => 'textfield',
        '#title' => t('Title'),
        '#description' => t('E.g. Reminder, the text is put underneath the business line')
    );

    $form['letter']['empf'] = array(
        '#type' => 'textarea',
        '#title' => t('Recipient'),
        '#default_value' => "Vorname~Nachname\nStraße~Hausnummer\nPLZ~Ort",
    );

    $form['letter']['opening'] = array(
        '#type' => 'textfield',
        '#title' => t('Opening'),
        '#default_value' => t('Dear Sir or Madame,')
    );




    $form['businessline'] = array(
        '#type' => 'fieldset',
        '#title' => t('Business line'),
    );
    $form['businessline']['place'] = array(
        '#type' => 'textfield',
        '#title' => t('Place'),
        '#description' => t('Place is put before the date')
    );
    $form['businessline']['date'] = array(
        '#type' => 'textfield',
        '#title' => t('Date'),
        '#description' => t('If empty, today will be used')
    );
    $form['businessline']['myref'] = array(
        '#type' => 'textfield',
        '#title' => t('My reference'),
    );
    $form['businessline']['yourref'] = array(
        '#type' => 'textfield',
        '#title' => t('Your reference'),
    );
    $form['businessline']['yourmail'] = array(
        '#type' => 'textfield',
        '#title' => t('Your mail'),
    );
    $form['businessline']['customer'] = array(
        '#type' => 'textfield',
        '#title' => t('Customer'),
    );
    $form['businessline']['invoice'] = array(
        '#type' => 'textfield',
        '#title' => t('Invoice'),
    );





    $form['additions'] = array(
        '#type' => 'fieldset',
        '#title' => t('Additional settings'),
    );
    $form['additions']['signature'] = array(
        '#type' => 'textfield',
        '#title' => t('Signature'),
        '#desciption' => t('If empty, sender name will be shown')
    );
    $form['additions']['ps'] = array(
        '#type' => 'textarea',
        '#title' => t('Post scriptum'),
    );
    $form['additions']['cc'] = array(
        '#type' => 'textarea',
        '#title' => t('Mailling list'),
        '#description' => t('Separate entries with double back slashes: \\\\')
    );
    $form['additions']['encl'] = array(
        '#type' => 'textarea',
        '#title' => t('Enclosures'),
        '#description' => t('Separate entries with double back slashes: \\\\')
    );
    $form['additions']['parskip'] = array(
        '#type' => 'select',
        '#title' => t('Paragraph skip'),
        '#options' => array(
            'off' => t('Indent, do not skip'),
            'full' => t('No indent, skip one line, at least 1em space on last paragraph line'),
            'full*' => t('No indent, skip one line, at least one quarter space on last paragraph line'),
            'full+' => t('No indent, skip one line, at least one third on last paragraph line'),
            'full-' => t('No indent, skip one line, last paragraph line can have any length'),
            'half' => t('No indent, skip half a line, at least 1em space on last paragraph line'),
            'half*' => t('No indent, skip half a line, at least one quarter space on last paragraph line'),
            'half+' => t('No indent, skip half a line, at least one third on last paragraph line'),
            'half-' => t('No indent, skip half a line, last paragraph line can have any length'),
        ),
        '#default_value' => 'full'
    );

    $form['additions']['schriftart'] = array(
        '#type' => 'select',
        '#title' => t('Font'),
        '#options' => array(
            'libertine' => 'Libertine',
            'palatino' => 'Palatino',
            'times' => 'Times',
            'chancery' => 'Zapf Chancery',
            'bookman' => 'Bookman',
            'newcent' => 'New Century Schoolbook',
            'charter' => 'Charter',
            'lmodern' => 'Latin Modern',
            'bera' => 'Bera',
        ),
    );

    $form['submit'] = array(
        '#type' => 'submit',
        '#value' => 'Submit',
    );

    $form['#redirect'] = 'texgen';

    return $form;
}


function texgen_docgenform($formstate) {
    $form['common'] = array(
        '#type' => 'fieldset',
        '#title' => t('Common settings'),
    );

    $form['common']['duplex'] = array(
        '#type' => 'radios',
        '#title' => t('Duplex document'),
        '#options' => array('yes'=>t('Yes, duplex'),'no'=>t('No, simplex')),
        '#default_value' => 'yes',
    );

    $form['common']['makeidx'] = array(
        '#type' => 'checkbox',
        '#title' => t('Generate index'),
        '#default_value' => '1'
    );

    $form['common']['makeglossar'] = array(
        '#type' => 'checkbox',
        '#title' => t('Generate glossary'),
    );

    $form['common']['makebiblio'] = array(
        '#type' => 'checkbox',
        '#title' => t('Generate bibliography'),
    );

    $form['common']['newcommands'] = array(
        '#type' => 'checkbox',
        '#title' => t('Define standard commands'),
        '#default_value' => '1'
    );

    $form['common']['definecolors'] = array(
        '#type' => 'checkbox',
        '#title' => t('Define default colours'),
        '#default_value' => '1'
    );

    $form['common']['schriftart'] = array(
        '#type' => 'select',
        '#title' => t('Font'),
        '#options' => array(
            'libertine' => 'Libertine',
            'palatino' => 'Palatino',
            'times' => 'Times',
            'chancery' => 'Zapf Chancery',
            'bookman' => 'Bookman',
            'newcent' => 'New Century Schoolbook',
            'charter' => 'Charter',
            'lmodern' => 'Latin Modern',
            'bera' => 'Bera',
        ),
    );

    $form['common']['bottomfill'] = array(
        '#type' => 'select',
        '#title' => t('Bottom line'),
        '#options' => array(
            'defaultbottom' => t('Default setting from document class'),
            'flushbottom' => 'flushbuttom: ' . t('equal page height, elastic line spacing'),
            'raggedbottom' => 'raggedbottom: ' . t('different page heights, constant line spacing'),
        )
    );



    $form['headfoottitle'] = array(
        '#type' => 'fieldset',
        '#title' => t('Header, footer, title page'),
    );

    $form['headfoottitle']['ihead'] = array(
        '#type' => 'textfield',
        '#title' => t('Inner or left header text'),
        '#description' => t('E.g. your logo or your company name.'),
    );

    $form['headfoottitle']['chead'] = array(
        '#type' => 'textfield',
        '#title' => t('Centered header text'),
    );

    $form['headfoottitle']['ohead'] = array(
        '#type' => 'textfield',
        '#title' => t('Outer or right header text'),
        '#description' => t('E.g. \headmark to show the current section.'),
    );

    $form['headfoottitle']['ifoot'] = array(
        '#type' => 'textfield',
        '#title' => t('Inner or left footer text'),
        '#description' => t('E.g. \tiny Your name.'),
    );

    $form['headfoottitle']['cfoot'] = array(
        '#type' => 'textfield',
        '#title' => t('Centered footer text'),
    );

    $form['headfoottitle']['ofoot'] = array(
        '#type' => 'textfield',
        '#title' => t('Outer or right footer text'),
        '#description' => t('E.g. \pagemark  to show the current page number.'),
    );

    $form['headfoottitle']['titletext'] = array(
        '#type' => 'textfield',
        '#title' => t('Title page heading'),
    );

    $form['headfoottitle']['titleautor'] = array(
        '#type' => 'textfield',
        '#title' => t('Author'),
    );

    $form['headfoottitle']['textzusammenfassung'] = array(
        '#type' => 'textarea',
        '#title' => t('Abstract'),
    );



    $form['pdfdocinfo'] = array(
        '#type' => 'fieldset',
        '#title' => t('PDF document information and settings'),
    );

    $form['pdfdocinfo']['pdfhyperref'] = array(
        '#type' => 'checkbox',
        '#title' => t('Use package hyperref'),
        '#default_value' => '1'
    );

    $form['pdfdocinfo']['pdfdraft'] = array(
        '#type' => 'checkbox',
        '#title' => t('Always generate pdf settings (draft=false)'),
        '#default_value' => '1'
    );

    $form['pdfdocinfo']['pdfbookmarks'] = array(
        '#type' => 'checkbox',
        '#title' => t('Generate bookmarks'),
        '#default_value' => '1'
    );

    $form['pdfdocinfo']['pdfbookmarksnum'] = array(
        '#type' => 'checkbox',
        '#title' => t('Include section numbers in bookmarks'),
        '#default_value' => '1'
    );

    $form['pdfdocinfo']['pdfbookmarksopen'] = array(
        '#type' => 'checkbox',
        '#title' => t('Bookmarks panel opened by default'),
        '#default_value' => '1'
    );

    $form['pdfdocinfo']['pdfcolorlinks'] = array(
        '#type' => 'checkbox',
        '#title' => t('Colour pdf links'),
        '#default_value' => '1'
    );

    $form['pdfdocinfo']['pdfauthor'] = array(
        '#type' => 'textfield',
        '#title' => t('Author'),
    );

    $form['pdfdocinfo']['pdftitle'] = array(
        '#type' => 'textfield',
        '#title' => t('Title'),
    );

    $form['pdfdocinfo']['pdfsubject'] = array(
        '#type' => 'textfield',
        '#title' => t('Subject'),
    );

    $form['pdfdocinfo']['pdfkeywords'] = array(
        '#type' => 'textfield',
        '#title' => t('Keywords'),
    );

    $form['pdfdocinfo']['pdfpagemode'] = array(
        '#type' => 'select',
        '#title' => t('Page mode'),
        '#options' => array(
            '1' => t('No setting'),
            '2' => t('Thumbnails opened'),
            '3' => t('Bookmarks opened'),
            '4' => t('Fullscreen'),
        ),
        '#default_value' => '3',
    );

    $form['pdfdocinfo']['pdfstartview'] = array(
        '#type' => 'select',
        '#title' => t('Page mode'),
        '#options' => array(
            '1' => t('No setting'),
            '2' => t('Fit page'),
            '3' => t('Fit page width'),
            '4' => t('Fit page contents'),
            '5' => t('Fit page contents width'),
        ),
        '#default_value' => '2',
    );

    $form['pdfdocinfo']['pdfview'] = array(
        '#type' => 'select',
        '#title' => t('Page mode when following internal links'),
        '#options' => array(
            '1' => t('No setting'),
            '2' => t('Fit page'),
            '3' => t('Fit page width'),
            '4' => t('Fit page contents'),
            '5' => t('Fit page contents width'),
        ),
        '#default_value' => '5',
    );

    $form['submit'] = array(
        '#type' => 'submit',
        '#value' => 'Submit',
    );

    $form['#redirect'] = 'texgen';

    return $form;
}

function texgen_docgenform_submit($form, &$form_state) {
    $texgenresult = '';
    
    $generaldokopts = '  idxtotoc,   % Index soll im Inhaltsverzeichnis stehen
% liststotoc, % Abbildungs- und Tabellenverzeichnis sollen im Inhaltsverzeichnis stehen
% bibtotoc,   % Literaturverzeichnis soll im Inhaltsverzeichnis stehen
  tocleft,    % Inhaltsverzeichnis nicht einrücken
% chapterprefix, % »Kapitel« vor Kapitelnummer ausgeben (nur scrreprt und scrbook)
% appendixprefix, % »Anhang« vor Anhangsnummer ausgeben
  a4paper,    % Papiergröße A4
  abstracton, % Zusammenfassung aktivieren
  titlepage,  % Eine Titelseite erstellen
' . ( $form_state['values']['duplex'] == "yes" ? " " : "%") . " twoside,    % zweiseitiges Layout
" . ( $form_state['values']['duplex'] == "no" ? " " : "%") . " oneside,    % einseitiges Layout
  DIVcalc
";

    $texgenresult .= "%\listfiles % für Fehlersuche\n% Dokumentenklasse und Optionen\n";
    $texgenresult .= '\documentclass[
  final,      % endgültige Fassung
% draft,      % Vorschau
' . $generaldokopts. ']{scrartcl} ';

    $texgenresult .= texgen_seps("Pakete einbinden");

    if ($form_state['values']['makeidx'] == "yes") $texgenresult .= '
\usepackage{makeidx} % Paket zur Indexerzeugung
\makeindex % Indexerzeugung aktivieren';

    $texgenresult .= "\n".($form_state['values']['makeglossar'] == "yes" ? "" : "%") . "\usepackage[style=altlist,toc=true,hyper=true,number=none]{glossary} % Paket für Glossar\n";
    $texgenresult .= ($form_state['values']['makeglossar'] == "yes" ? "" : "%") . "\makeglossary % Glossarerzeugung aktivieren\n";
    $texgenresult .= "%Glossareinträge an der jeweiligen Textstelle mit:
% \glossary{
%   name={Computer},
%   description={Eine Maschine zur Lösung von Problemen,
%     die es ohne diese Maschine nicht gäbe.}
% }\n";
    $texgenresult .= "%Erstellung des Glossars mit makeindex:
%makeindex -s dateiname.ist -t dateiname.glg -o dateiname.gls dateiname.glo\n";

    $texgenresult .= '
\usepackage[headsepline,footsepline]{scrpage2} % Kopf- und Fußzeile
\usepackage[utf8]{inputenc} % Encoding der TeX-Dateien:
% latin1 = Windows,
% ansi = Linux alt,
% utf8 = Linux aktuell
\usepackage[T1]{fontenc} % Aktiviert EC-Schriftarten
\usepackage{ae} % Schöne Schriften für PDF-Dateien
\usepackage{textcomp} % Text-Companion-Symbols (z. B. \texteuro)
\usepackage[ngerman]{babel} % Deutsche Einstellungen
%Paket times ist veraltet, siehe
% http://www.ctan.org/tex-archive/info/german/l2tabu/l2tabu.pdf
% \usepackage{times} % Times-Schriftart auswählen
';

    $texgenresult .= texgen_fontselect($form_state['values']['schriftart']);

    $texgenresult .= '
\usepackage{marvosym} % Symbole und das Euro-Zeichen \EUR
\usepackage{eurosym} % Euro-Zeichen nach offz. Vorgaben, Geld durch \EUR{100,00}
\usepackage[final]{microtype} % Mikrotypographische Anpassungen
\usepackage{fixltx2e} % korrigiert LaTeX-Fehler
%\usepackage{mparhack} % wenn verfügbar, korrigiert Fehler bei marginpar-Befehl
\usepackage{color,graphics,graphicx} % Unterstützung für Grafiken und Farben
\usepackage{picins} % Text umfließt Grafiken
%\usepackage{eso-pic} % nur falls Entwurf-Seitenhintergrund
% \usepackage{url} % nur falls kein hyperref-Paket genutzt wird
% \usepackage{longtable} % für Tabellen über mehrere Seiten
% \usepackage{fancyvrb} % für verbatiminput
% \usepackage{listings} % Quelltexte formatiert ausgeben
\usepackage{booktabs} % Tabellenformatierungsbefehle top-/mid-/bottomrule
\usepackage{caption}
%\usepackage[ngerman]{varioref} % variable Referenzen
%\usepackage[square]{natbib} % Literaturverzeichnis
';

    if ($form_state['values']['pdfhyperref'] == "1") {
        $texgenresult .= "% PDF-Optionen, PDF-Hyperlinks\n\usepackage[";
        if ($form_state['values']['pdfdraft'] == "false") $texgenresult .= "draft=false, %\n  ";
        if ($form_state['values']['pdfbookmarks'] == "1") {
            $texgenresult .= 'bookmarks=true, ';
            if ($form_state['values']['pdfbookmarksnum'] == "1") $texgenresult .= 'bookmarksnumbered=true, ';
            if ($form_state['values']['pdfbookmarksopen'] == "1") $texgenresult .= "bookmarksopen=true, %\n  ";
        }
        if ($form_state['values']['pdfcolorlinks'] == "1") $texgenresult .= "colorlinks, linkcolor=blue, urlcolor=blue, %\n  ";


        if ($form_state['values']['pdfauthor'] != "") $texgenresult .= 'pdfauthor={' . stripslashes(texgen_xhtmlchars($form_state['values']['pdfauthor'])). '}, ';
        if ($form_state['values']['pdftitle'] != "") $texgenresult .= 'pdftitle={' . stripslashes(texgen_xhtmlchars($form_state['values']['pdftitle'])). '}, ';
        if ($form_state['values']['pdfsubject'] != "") $texgenresult .= 'pdfsubject={' . stripslashes(texgen_xhtmlchars($form_state['values']['pdfsubject'])). '}, ';
        if ($form_state['values']['pdfkeywords'] != "") $texgenresult .= 'pdfkeywords={' . stripslashes(texgen_xhtmlchars($form_state['values']['pdfkeywords'])). '}, ';

        switch ($form_state['values']['pdfpagemode']) {
            case 2 : $texgenresult .= 'pdfpagemode=UseThumbs, ';
                break;
            case 3 : $texgenresult .= 'pdfpagemode=UseOutlines, ';
                break;
            case 4 : $texgenresult .= 'pdfpagemode=FullScreen, ';
                break;
        }

        switch ($form_state['values']['pdfstartview']) {
            case 2 : $texgenresult .= 'pdfstartview=Fit, ';
                break;
            case 3 : $texgenresult .= 'pdfstartview=FitH, ';
                break;
            case 4 : $texgenresult .= 'pdfstartview=FitB, ';
                break;
            case 5 : $texgenresult .= 'pdfstartview=FitBH, ';
                break;
        }

        switch ($form_state['values']['pdfview']) {
            case 2 : $texgenresult .= 'pdfview=Fit, ';
                break;
            case 3 : $texgenresult .= 'pdfview=FitH, ';
                break;
            case 4 : $texgenresult .= 'pdfview=FitB, ';
                break;
            case 5 : $texgenresult .= 'pdfview=FitBH, ';
                break;
        }

        $texgenresult .= 'a4paper]{hyperref}
\usepackage[all]{hypcap} %Klicken auf Verweise rückt Ziel in den Mittelpunkt
%\usepackage{pdfcolmk} %bei Problemen mit Farben beim Seitenwechsel';
    }

    $texgenresult .= '

%veraltete Pakete, die nicht mehr benötigt werden
%t1enc = ersetzt durch fontenc
%times = ersetzt durch mathptmx
%a4    = ersetzt durch Klassenoption a4paper';

    if ($form_state['values']['newcommands'] == "yes") {
        $texgenresult .= texgen_seps("Standardbefehle für \\newcommand");
        $texgenresult .= '
%%Dieses Kommando trennt die einzelnen Dokumentenabschnitte
%%wahlweise eine neue Seite
\newcommand{\ABSCHNITTSTRENNER}{\cleardoublepage }';

        $texgenresult .= '
%%Dieses Kommando setzt einen Backslash,
%%an dem ohne ein Trennzeichen getrennt werden kann
\newcommand{\trennBS}{\texttt{\char92}" "}';

        $texgenresult .= '

%Einstellungen für Abbildungsbeschriftungen
\captionsetup{margin=10pt,font=small,labelfont=bf,position=bottom}

%%Dieses Kommando setzt um den übergebenen Parameter
%%deutsche doppelte Anführungszeichen
\newcommand{\gdq}[1]{\glqq{}#1\grqq{}}
';

        $texgenresult .= "
%%Dieses Kommando setzt um den übergebenen Parameter
%%französische Anführungszeichen (innen, außen, einfach, doppelt)\n";
        $texgenresult .= "\\newcommand{\\fqi}[1]{\\frq#1\\flq}                 % Anführungsz. einfach\n";
        $texgenresult .= "\\newcommand{\\fqqi}[1]{\\frqq#1\\flqq}              % Anführungsz. doppelt\n";
        $texgenresult .= "\\newcommand{\\fqa}[1]{\\flq#1\\frq}                 % Anführungsz. einfach\n";
        $texgenresult .= "\\newcommand{\\fqqa}[1]{\\flqq#1\\frqq}              % Anführungsz. doppelt\n";
        $texgenresult .= "
%enquote-Befehl für alle Anführungszeichen verwenden,
%dann kann schnell eine andere Formatierung genutzt werden
%\\newcommand{\\enquote}[1]{\\fqqi{#1}}              % diese Anf.zeichen nutzen
\\usepackage[babel,german=guillemets]{csquotes} % falls Paket nicht vorhanden, vorherige Zeile aktivieren\n\n";


        $texgenresult .= '%%Ein Platzhalter für Daten, die später ergänzt werden
\usepackage[margin,ngerman]{fixme}
\newcommand{\weissnicht}{XX?\-XX?\-XX?\-XX\fixme{Hier fehlt was!}}
';

        $texgenresult .= '
%%Der Parameter erscheint im Text und im Index
\newcommand{\textindex}[1]{#1\index{#1}}';
    }

    if ($form_state['values']['definecolors'] == "yes") {
        $texgenresult .= texgen_seps("Standardfarben definieren");
        $texgenresult .= "\\definecolor{gruen}{rgb}{0.0,1.0,0.0}\n";
        $texgenresult .= "\\definecolor{gelb}{rgb}{1.0,1.0,0.0}\n";
        $texgenresult .= "\\definecolor{weiss}{rgb}{1.0,1.0,1.0}\n";
        $texgenresult .= "\\definecolor{schwarz}{rgb}{0.0,0.0,0.0}\n";
        $texgenresult .= "\\definecolor{rot}{rgb}{1.0,0.0,0.0}\n";
    }

    $texgenresult .= texgen_seps("Kopf- und Fußzeile definieren");
    $texgenresult .= '\manualmark % Manuelle Einstellungen anschalten
\pagestyle{scrheadings}
\ihead{%\includegraphics[height=2ex,draft=false]{zusatz/logo}
' . stripslashes(texgen_xhtmlchars($form_state['values']['ihead'])). '}
\chead{' . stripslashes(texgen_xhtmlchars($form_state['values']['chead'])). '}
\ohead{' . stripslashes(texgen_xhtmlchars($form_state['values']['ohead'])). '}

\ifoot{' . stripslashes(texgen_xhtmlchars($form_state['values']['ifoot'])). '}
\cfoot{' . stripslashes(texgen_xhtmlchars($form_state['values']['cfoot'])). '}
\ofoot{' . stripslashes(texgen_xhtmlchars($form_state['values']['ofoot'])). '}

% Eine Seite ohne Kopf- und Fußzeile
\defpagestyle{plainwfl}{(0pt,0pt){} {} {}(0pt,0pt)}{(0pt,0pt){} {} {}(0pt,0pt)}
';

    $texgenresult .= "\n%%Unterste Zeile\n";
    $texgenresult .= ( $form_state['values']['bottomfill'] == "flushbottom" ? "" : "%") . "\\flushbottom % gleiche Höhe, elastische vertikale Abstände\n";
    $texgenresult .= ( $form_state['values']['bottomfill'] == "raggedbottom" ? "" : "%") . "\\raggedbottom % wechselnde Höhe, konstante vertikale Abstände\n\n";

    $texgenresult .= '\begin{document}';
    $texgenresult .= texgen_seps("Befehle für die Titelseite");
    $texgenresult .= '\title{
%\includegraphics[scale=1.0]{zusatz/logo_a} \\\\
' . stripslashes(texgen_xhtmlchars($form_state['values']['titletext'])). '
%\includegraphics[draft=false,scale=0.333]{zusatz/logo_a}
}
\author{' . stripslashes(texgen_xhtmlchars($form_state['values']['titleautor'])). '}
%Datum wird automatisch eingefügt
\pdfbookmark[1]{Titelseite}{titel}
\maketitle
\thispagestyle{plainwfl}

\mbox{}

\vfill
';
    $texgenresult .= texgen_seps("Die Zusammenfassung") . '\begin{abstract}\pdfbookmark[1]{Zusammenfassung}{}
' . stripslashes(texgen_xhtmlchars($form_state['values']['textzusammenfassung'])). '
\end{abstract}

\markleft{' . stripslashes(texgen_xhtmlchars($form_state['values']['markleft'])). '}
\markright{Inhaltsverzeichnis}

\ABSCHNITTSTRENNER
\pdfbookmark[1]{\contentsname}{toc}
\tableofcontents
\listoffigures
\listoftables
\listoffixmes

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ABSCHNITTSTRENNER
\markright{Allgemeines}
\include{texteile/allgemeines}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ABSCHNITTSTRENNER
\appendix
\markright{Anhang}
\include{texteile/anhang}
';
    if ($form_state['values']['makeglossar'] == "yes") $texgenresult .= '
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ABSCHNITTSTRENNER
\markright{Glossar}
\def\glossaryname{Glossar}
\printglossary
'; else $texgenresult .=  '
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\ABSCHNITTSTRENNER
%\markright{Glossar}
%\def\glossaryname{Glossar}
%\printglossary
';

    $texgenresult .= '
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ABSCHNITTSTRENNER
\markright{Index}
\renewcommand*{\indexpagestyle}{scrheadings}
\printindex
';

    $texgenresult .= "\n%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n";
    $c = ($form_state['values']['makebiblio'] == "yes" ? "" : "%");
    $texgenresult .= "$c\ABSCHNITTSTRENNER
        $c\markright{Literaturverzeichnis}
%\bibliographystyle{dinat}%[Autor, Jahr]
        $c\bibliographystyle{gerplain} %einfache Zahl
        $c\bibliography{dateiname}

\end{document}</pre>";

    global $_SESSION;
    $_SESSION['texgendata'] = $texgenresult;

    drupal_set_message(t('Your document has been created.'));
}


function texgen_docgen() {
    $r = drupal_get_form('texgen_docgenform');

    return $r;
}

function texgen_submit($form, &$form_state) {
    return '<p>' . t('Your document') . ' </p>';
}

function texgen_page() {
    $r = $_SESSION['texgendata'];
    if (!empty($r)) $r = "<pre>" . $r . "</pre>";

    return '<p>' . l('LaTeX Document', 'texgen/doc') . ' ' . l('LaTeX Letter', 'texgen/letter') . '</p>' . $r;
}




function texgen_seps($text) {
    return "\n\n%% ==================================\n".
        "%% " . $text . "\n".
        "%% ==================================\n";
}

function texgen_sepsfont($text) {
    return "%\n%  -- $text --\n";
}

function texgen_fontselect($fontname) {
    $r = "";
    $r .= "%Auswahl der Schriftarten:\n";

    //Palatino
    $com = ($fontname == "palatino" ? "" : "%");
    $r .= texgen_sepsfont("Palatino") .
        "% Paket mathpazo akzeptiert diese Optionen:
% leer    lieber nicht benutzen
% [sc]    Palatino(pplx) mit echten Kapitälchen
% [osf]   Palatino(pplj) mit echten Kapitälchen und
%         Oldstyle-Zahlen im Text
$com\usepackage[sc]{mathpazo}
$com\linespread{1.04} % Zeilenabstand passend zur Schriftart erhöen
$com\usepackage[scaled=.95]{helvet}
$com\usepackage{courier}
";


    //Times
    $com = ($fontname == "times" ? "" : "%");
    $r .= texgen_sepsfont("Times") .
        "$com\usepackage{mathptmx} % Times
$com\usepackage[scaled=.90]{helvet}
$com\usepackage{courier}
";


    //Zapf Chancery
    $com = ($fontname == "chancery" ? "" : "%");
    $r .= texgen_sepsfont("Zapf Chancery") .
        "$com\usepackage{chancery}
$com\usepackage[scaled=.90]{helvet}
$com\usepackage{courier}
";


    //Bookman
    $com = ($fontname == "bookman" ? "" : "%");
    $r .= texgen_sepsfont("Bookman") .
        "$com\usepackage{bookman}
$com\usepackage[scaled=.90]{helvet}
$com\usepackage{courier}
";


    //New Century Schoolbook
    $com = ($fontname == "newcent" ? "" : "%");
    $r .= texgen_sepsfont("New Century Schoolbook") .
        "$com\usepackage{newcent}
$com\usepackage[scaled=.90]{helvet}
$com\usepackage{courier}
";


    //Charter
    $com = ($fontname == "charter" ? "" : "%");
    $r .= texgen_sepsfont("Charter") .
        "$com\usepackage{charter}
$com\usepackage[scaled=.90]{helvet}
$com\usepackage{courier}
";

    //Latin Modern
    $com = ($fontname == "lmodern" ? "" : "%");
    $r .= texgen_sepsfont("Latin Modern") .
        "$com\usepackage{lmodern}
";

    //Bera
    $com = ($fontname == "bera" ? "" : "%");
    $r .= texgen_sepsfont("Bera") .
        "$com\usepackage{bera}
";

    //Libertine
    $com = ($fontname == "libertine" ? "" : "%");
    $r .= texgen_sepsfont("Libertine") .
        "$com\usepackage{libertine}
";

    $r .= "\n\n\\typearea[current]{last}";
    return $r;
}

function texgen_xhtmlchars($text) {
	return str_replace("'", "&apos;", str_replace("\"", "&quot;", str_replace(">", "&gt;", str_replace("<", "&lt;", str_replace("&", "&amp;", $text)))));
}
